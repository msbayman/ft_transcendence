{% block content %}
<div id="chat-messages">
  {% for message in messages %}
  <div
    class="message {% if message.sender == request.user %}sent{% else %}received{% endif %}"
  >
    {{ message.content }}
  </div>
  {% endfor %}
</div>

<form id="chat-form">
  <input type="text" id="message-input" autocomplete="off" />
  <button type="submit">Send</button>
</form>

<script>
  const username = "{{ other_user.username }}";
  const chatSocket = new WebSocket(
    "ws://" + window.location.host + "/ws/chat/" + username + "/"
  );

  document.querySelector("#chat-form").addEventListener("submit", function (e) {
    e.preventDefault();
    const messageInput = document.querySelector("#message-input");
    const message = messageInput.value;

    chatSocket.send(
      JSON.stringify({
        message: message,
      })
    );

    // Clear the input field after sending
    messageInput.value = "";
  });

  chatSocket.onmessage = function (e) {
    const data = JSON.parse(e.data);
    const messagesDiv = document.querySelector("#chat-messages");
    const messageDiv = document.createElement("div");

    // Differentiate between sent and received messages
    if (data.sender === "{{ request.user.username }}") {
      messageDiv.classList.add("message", "sent");
    } else {
      messageDiv.classList.add("message", "received");
    }

    messageDiv.textContent = data.message;
    messagesDiv.appendChild(messageDiv);
  };
</script>

{% endblock %}
